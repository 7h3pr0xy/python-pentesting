# -*- encoding: utf-8 -*-
#class for HttpScan connection

import socket
import urllib2
import httplib
import socket
import HTMLParser
import socket
import base64
import sys

class HTTPScan:
    
    def basic_auth(self, host, username, passwd, code=0):
        try:
            request = urllib2.Request(host)
            base64string = base64.encodestring('%s:%s' % (username, passwd))[:-1]
            request.add_header("Authorization", "Basic %s" % base64string)   
            result = urllib2.urlopen(request)
            stdout.write('\033[K')
            print 'Found %s:%s\n' %(username, passwd)
        except (socket.gaierror, socket.error, IOError) as e:
            print e
            code = 2
        return code
        
    def startHTTPScanBruteForce(self,host):
        try:

            print '\n###### Started scanning \'%s\' ######\n' % (host)
            
            #open files dictionary
            users_file = open("users.txt")
            passwords_file = open("passwords.txt")
            for user in users_file.readlines():
                for password in passwords_file.readlines():
                
                    user_text = user.strip("\n")
                    password_text = password.strip("\n")
                    try:
                                    #check connection with user and password
                                    response = self.basic_auth(host,user_text,password_text)
                                    if response == 0:
                                            print("[*] User: %s [*] Pass Found:%s" %(user_text,password_text))
                                            sys.exit(0)
                                    elif response == 1:
                                        print("[*] User: %s [*] Pass %s => Login incorrect !!!" %(user,password))
                                    elif response == 2:
                                        print("[*] Connection could not be established to %s" %(host))
                                        sys.exit(2)
				
                    except Exception,e:
                                print "Error http scan"
                                pass
            #close files
            users_file.close()
            passwords_file.close()
        
        except Exception,e:
            print "users.txt /passwords.txt Not found"
            pass
